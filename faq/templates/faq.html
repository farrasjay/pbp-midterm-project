{% extends 'base.html' %}
{% block content %}
<title>FAQ</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">


<style>
    @import url('https://fonts.googleapis.com/css2?family=Sora:wght@100;300;400&display=swap');
    * {
        font-family: 'Sora', sans-serif;
    }
    .like-form{
        flex-direction:row-reverse;
        display: flex;
    }
    .button-icon{
        align-self:flex-end;
    }
    .plus-info{
        display: flex;
        flex-direction:row-reverse;
        padding: 1px;
    }

    .faq-container{
        display: flex;
        flex-wrap: wrap;
    }
    .card{
        margin-bottom: 10px;
        margin-right: 40px;
        padding-inline: 15px;
        display: flex;
        flex-direction:row;
    }
    .card:hover{
        transform: scale(1.025);
        box-shadow: 5px 6px 6px 2px #e9ecef;
    }
    .card-header {
        background-color: #27645c;
        color :#ffffff;
        
    }
    .card-body {
        margin-bottom: 1px;
        background-color: #ffffff;
        display: flex;
        flex-direction:column;
    }

    .card-text {
        text-align: justify;
    }

    .bi:hover {
        color: darkblue;
    }

    body{
        background-color: #ffffff;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2000 1500'%3E%3Cdefs%3E%3Crect stroke='%23ffffff' stroke-width='.5' width='1' height='1' id='s'/%3E%3Cpattern id='a' width='3' height='3' patternUnits='userSpaceOnUse' patternTransform='scale(50) translate(-980 -735)'%3E%3Cuse fill='%23fcfcfc' href='%23s' y='2'/%3E%3Cuse fill='%23fcfcfc' href='%23s' x='1' y='2'/%3E%3Cuse fill='%23fafafa' href='%23s' x='2' y='2'/%3E%3Cuse fill='%23fafafa' href='%23s'/%3E%3Cuse fill='%23f7f7f7' href='%23s' x='2'/%3E%3Cuse fill='%23f7f7f7' href='%23s' x='1' y='1'/%3E%3C/pattern%3E%3Cpattern id='b' width='7' height='11' patternUnits='userSpaceOnUse' patternTransform='scale(50) translate(-980 -735)'%3E%3Cg fill='%23f5f5f5'%3E%3Cuse href='%23s'/%3E%3Cuse href='%23s' y='5' /%3E%3Cuse href='%23s' x='1' y='10'/%3E%3Cuse href='%23s' x='2' y='1'/%3E%3Cuse href='%23s' x='2' y='4'/%3E%3Cuse href='%23s' x='3' y='8'/%3E%3Cuse href='%23s' x='4' y='3'/%3E%3Cuse href='%23s' x='4' y='7'/%3E%3Cuse href='%23s' x='5' y='2'/%3E%3Cuse href='%23s' x='5' y='6'/%3E%3Cuse href='%23s' x='6' y='9'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='h' width='5' height='13' patternUnits='userSpaceOnUse' patternTransform='scale(50) translate(-980 -735)'%3E%3Cg fill='%23f5f5f5'%3E%3Cuse href='%23s' y='5'/%3E%3Cuse href='%23s' y='8'/%3E%3Cuse href='%23s' x='1' y='1'/%3E%3Cuse href='%23s' x='1' y='9'/%3E%3Cuse href='%23s' x='1' y='12'/%3E%3Cuse href='%23s' x='2'/%3E%3Cuse href='%23s' x='2' y='4'/%3E%3Cuse href='%23s' x='3' y='2'/%3E%3Cuse href='%23s' x='3' y='6'/%3E%3Cuse href='%23s' x='3' y='11'/%3E%3Cuse href='%23s' x='4' y='3'/%3E%3Cuse href='%23s' x='4' y='7'/%3E%3Cuse href='%23s' x='4' y='10'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='c' width='17' height='13' patternUnits='userSpaceOnUse' patternTransform='scale(50) translate(-980 -735)'%3E%3Cg fill='%23f2f2f2'%3E%3Cuse href='%23s' y='11'/%3E%3Cuse href='%23s' x='2' y='9'/%3E%3Cuse href='%23s' x='5' y='12'/%3E%3Cuse href='%23s' x='9' y='4'/%3E%3Cuse href='%23s' x='12' y='1'/%3E%3Cuse href='%23s' x='16' y='6'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='d' width='19' height='17' patternUnits='userSpaceOnUse' patternTransform='scale(50) translate(-980 -735)'%3E%3Cg fill='%23ffffff'%3E%3Cuse href='%23s' y='9'/%3E%3Cuse href='%23s' x='16' y='5'/%3E%3Cuse href='%23s' x='14' y='2'/%3E%3Cuse href='%23s' x='11' y='11'/%3E%3Cuse href='%23s' x='6' y='14'/%3E%3C/g%3E%3Cg fill='%23efefef'%3E%3Cuse href='%23s' x='3' y='13'/%3E%3Cuse href='%23s' x='9' y='7'/%3E%3Cuse href='%23s' x='13' y='10'/%3E%3Cuse href='%23s' x='15' y='4'/%3E%3Cuse href='%23s' x='18' y='1'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='e' width='47' height='53' patternUnits='userSpaceOnUse' patternTransform='scale(50) translate(-980 -735)'%3E%3Cg fill='%23F60'%3E%3Cuse href='%23s' x='2' y='5'/%3E%3Cuse href='%23s' x='16' y='38'/%3E%3Cuse href='%23s' x='46' y='42'/%3E%3Cuse href='%23s' x='29' y='20'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='f' width='59' height='71' patternUnits='userSpaceOnUse' patternTransform='scale(50) translate(-980 -735)'%3E%3Cg fill='%23F60'%3E%3Cuse href='%23s' x='33' y='13'/%3E%3Cuse href='%23s' x='27' y='54'/%3E%3Cuse href='%23s' x='55' y='55'/%3E%3C/g%3E%3C/pattern%3E%3Cpattern id='g' width='139' height='97' patternUnits='userSpaceOnUse' patternTransform='scale(50) translate(-980 -735)'%3E%3Cg fill='%23F60'%3E%3Cuse href='%23s' x='11' y='8'/%3E%3Cuse href='%23s' x='51' y='13'/%3E%3Cuse href='%23s' x='17' y='73'/%3E%3Cuse href='%23s' x='99' y='57'/%3E%3C/g%3E%3C/pattern%3E%3C/defs%3E%3Crect fill='url(%23a)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23b)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23h)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23c)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23d)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23e)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23f)' width='100%25' height='100%25'/%3E%3Crect fill='url(%23g)' width='100%25' height='100%25'/%3E%3C/svg%3E");
        background-attachment: fixed;
        background-size: cover;
    }
</style>

<div class="container">
    <h1><br><strong>Frequently Asked Questions</strong></h1>
    <br>
    <div class="faq-container">
        {% for data in data_faq %}
        <div class="card mb-3" style="width: 32rem;">
            <div class="card-header">
                <h5><strong> {{data.question}}</strong></h5>
                <i onclick="showAnswer('{{data.id}}')" class="bi bi-plus-circle-fill" style="font-size: 2rem;"></i>
            </div>
                <div class="card-body"> 
                    <div class="card-text">
                        <div class="text{{data.id}}">{{data.answer}}</div>
                    </div>
                    <form action="{% url 'faq:like' %}" method="POST" class='like-form' id='{{data.id}}'>
                        {% csrf_token %}
                        <input type="hidden" name="post_id" value={{data.id}}>
                        <input type="hidden" id = "id-user" value="{{user.id}}"/>
                        <input type="hidden" id = "status_user" value="{{data.status_user}}"/>
                        <div class="button-icon">
                            <button type="submit" class="btn btn-outline-danger" id="like-btn{{data.id}}">
                                {% if user not in data.liked.all %}
                                    Like
                                {% else %}
                                    Unlike
                                {% endif %}
                            </button>
                        </div>
                    </form> 
                </div>
                <div class="card-footer mx-auto">

                    <div class=" plus-info">
                        <div class = icon-image{{data.id}}>
                            {% if user in data.liked.all %}
                                <span class = icon-fill{{data.id}}>
                                    <input type="hidden" id = "status_like" value="1"/>
                                    <i class="bi bi-heart-fill"></i>
                                </span>
                            {% else %}
                                <span class = icon-heart{{data.id}}>
                                    <input type="hidden" id = "status_like" value="2"/>
                                    <i class="bi bi-heart"></i>
                                </span>

                            {% endif %}
                        </div>
                        <div class="count-like">
                            <div class="like-count{{data.id}}"> {{data.num_likes}}</div>
                        </div>
                    </div>

                </div>
        </div>
        {% endfor %} 
    </div>
</div>

<div class="modal fade" id="modal-login" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <b>Warning!</b>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
             
            <div class="modal-body">
                <p>Anda Perlu Login</p>
            </div>
        </div>
    </div>
</div>
</div>

<script>
    $( document ).ready(function() {
        $(`.text1`).hide();
        $(`.text2`).hide();
        $(`.text3`).hide();
        $(`.text4`).hide();
        $(`.text5`).hide();
        $(`.text6`).hide();
        $(`.text7`).hide();
        $(`.text8`).hide();

        $('.like-form').submit(function(e){
            e.preventDefault()

            var user =  document.getElementById("id-user").value;
            
            const post_id = $(this).attr('id')
            
            const likeText = $(`#like-btn${post_id}`).text()
            const trim = $.trim(likeText)

            const url = $(this).attr('action')
            
            let res;
            const likes = $(`.like-count${post_id}`).text()
            const trimCount = parseInt(likes)
 
            
            
            $.ajax({
                type: 'POST',
                url: url,
                async: true,
                data: {
                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                    'post_id':post_id,
                },
                
                success: function(response) {
                    
                    var status = document.getElementById("status_user").value;
                    $(`.icon-heart${post_id}`).toggle("bi-heart")
                    if(user>0){
                        
                        if(trim === 'Unlike') {
                            console.log(document.getElementById("status_like").value)
                            $(`#like-btn${post_id}`).text("Like")
                            res = trimCount - 1
                            if(document.getElementById("status_like").value=="1"){
                                $(`.icon-fill${post_id}`).empty()
                                $(`.icon-fill${post_id}`).append("<i class='bi bi-heart'></i>")
                                $(`.icon-fill${post_id}`).toggle("bi-heart-fill")
                            }
                            // $(`.icon-fill${post_id}`).toggle("bi-heart-fill")
                            else{
                                $(`.icon-heart${post_id}`).empty()
                                $(`.icon-heart${post_id}`).append("<i class='bi bi-heart'></i>")
                                $(`.icon-heart${post_id}`).toggle("bi-heart-fill")
                            }

                            
                        }
                        else {
                            $(`#like-btn${post_id}`).text("Unlike")
                            res = trimCount + 1
                            console.log(document.getElementById("status_like").value)
                            // $(`.icon-fill${post_id}`).toggle("bi-heart-fill")
                            if(document.getElementById("status_like").value=="1"){
                                $(`.icon-fill${post_id}`).empty()
                                $(`.icon-fill${post_id}`).append("<i class='bi bi-heart-fill'></i>")
                                $(`.icon-fill${post_id}`).toggle("bi-heart-fill")
                            }
                            // $(`.icon-fill${post_id}`).toggle("bi-heart-fill")
                            else{
                                $(`.icon-heart${post_id}`).empty()
                                $(`.icon-heart${post_id}`).append("<i class='bi bi-heart-fill'></i>")
                                $(`.icon-heart${post_id}`).toggle("bi-heart-fill")
                            }
                            
                         }

                        $(`.like-count${post_id}`).text(res)
                    }
                    else{
                        $("#modal-login").modal('show');
                    }

                },
                error: function(response) {
                    
                    console.log('error', response)
                }
            })

        })


    });
    function showAnswer(id){
        var id_text = parseInt(id)
        $(`.text${id_text}`).toggle();
    }
</script>



{% endblock content %}